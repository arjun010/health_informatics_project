<html>
<head>
	<title>FHIR DART</title>
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/bootstrap-theme.min.css">
	<script src="js/jquery-2.1.3.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/d3.v3.min.js"></script>
	<script src="js/d3-tip.js"></script>
	<script src="js/histogram.js"></script>
	<script src="js/bars.js"></script>
	<script src="js/donutChart.js"></script>
	<script src="js/bubble_chart.js"></script>
	<script type="text/javascript">
	
	var activeCondition = "";

		var allEncounters = (function() {
        var json = null;
        $.ajax({
            'async': false,
            'global': false,
            'url': "data/encounters.json",
            'dataType': "json",
            'success': function (data) {
                json = data;
            }
        });
        return json;
    	})();

    	var encounterHistoryData = (function() {
        var json = null;
        $.ajax({
            'async': false,
            'global': false,
            'url': "data/encounterHistory.json",
            'dataType': "json",
            'success': function (data) {
                json = data;
            }
        });
        return json;
    	})();


    	var filteredEncounterData = [];
    	var filteredChoronologicalVisData = [];
    	var filteredEncounterDataByCondition = [];
    	var filteredMemberDataByCondition = [];
	</script>
</head>
<style>

body {
    padding-top: 50px; /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
}

path.slice{
	stroke-width:2px;
}

polyline{
	opacity: .3;
	stroke: black;
	stroke-width: 2px;
	fill: none;
}


.barz rect {
  fill: #3366CC;
  shape-rendering: crispEdges;  
}

.barz text {
  fill: #fff;
}

.bar text {
  fill: #fff;
}

.axis text {
	font: 10px sans-serif;
}
.axis path, .axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
  text-color:white;
  size: 10px;
}
.x-axis path, .x-axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
  text-color:white;
}

.d3-tip {
  line-height: 1;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
  font: 12px sans-serif;
  font-weight: bold;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
.bubble{
cursor:pointer;
}
</style>
<body style="background-color:#F8F8F5;">
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
				<!-- Collect the nav links, forms, and other content for toggling 
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span
                </button>>-->
                <a class="navbar-brand" href="#" style="color:#C8C8C8;margin-left:80px;"><b>FHIR DART</b></a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<a class="navbar-brand" href="#people" style="margin-left:100px"><b>Encounter-level</b></a>
				<a class="navbar-brand" href="#courses" style="margin-left:50px"><b>Patient-level</b></a>
                <!-- <ul class="nav navbar-nav">
                    <li>
                        <a href="#people">People</a>
                    </li>
                    <li>
                        <a href="#">Research</a>
                    </li> 
                    <li>
                        <a href="#">News</a>
                    </li>
                </ul> -->
            </div>
            <!-- /.navbar-collapse -->
        
        <!-- /.container -->
    </nav>

		<div class="col-sm-2">
			<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingOne">
				  <h4 class="panel-title">
					<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
					  Age range
					</a>
				  </h4>
				</div>
				<div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
				  <div class="panel-body">
					From: <select onchange="applyFilters()" style="margin-left:10px;margin-right:10px;" id="agerangestart"></select>
					To: <select onchange="applyFilters()" style="margin-left:10px;" id="agerangeend"></select>
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingTwo">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
					  Gender
					</a>
				  </h4>
				</div>
				<div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
				  <div class="panel-body">
					<input onchange="applyFilters()" checked="true" type="checkbox" id="genderboth" value="both">Both</input>
					<input onchange="applyFilters()" type="checkbox" id="gendermale" value="male">Male</input>
					<input onchange="applyFilters()" type="checkbox" id="genderfemale" value="female">Female</input>
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingThree">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
					  Year Range
					</a>
				  </h4>
				</div>
				<div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
				  <div class="panel-body">
					From: <select onchange="applyFilters()" style="margin-left:10px;margin-right:10px;" id="daterangestart"></select>
					To: <select onchange="applyFilters()" style="margin-left:10px;" id="daterangeend"></select>
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingFour">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
					  Marriage Status
					</a>
				  </h4>
				</div>
				<div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
				  <div class="panel-body" id="marriagestatusoptionlist">		        
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingFive">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
					  Job
					</a>
				  </h4>
				</div>
				<div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
				  <div class="panel-body" id="joboptionlist">
					
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingSix">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
					  Immunizations
					</a>
				  </h4>
				</div>
				<div id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix">
				  <div class="panel-body" id="immunizationoptionlist">
					
				  </div>
				</div>
			  </div>
			</div>
		</div>
		
		<div class="col-sm-8">	

			<table style="margin-top:20px;width:100%;">
				<tr>
					<td align="center">
						<p style="font-size:30px;" id="encountercounttext"></p>
					</td>
					<td align="center">
						<p style="font-size:30px;" id="membercounttext"></p>
					</td>
				</tr>
			</table>		
			<div align="center" style="margin-left:150px;" id="bubblechart">
				<!--<img src="bubble_placeholder.jpg" style="border:1px solid black;" onClick="draw_charts_all()"></img>-->
			</div>			
			<table align="left">
				<tr>
					<div align="center" id="selected-bubble"></div>
				</tr>
				<tr>
					<td style="width:250px;">
						<div id="bardrugs" style="width: 550px"></div>
					</td>
					<td align="left" style="width:250px;">
						<div id="barlabtest" style="width: 550px"></div>
					</td>				
					<td>
						<p class="hide" id="visittypeheading" style="margin-left:70px;font-size:13px;font-family:sans-serif;">Visit Types</p>
						<div align="center" id="visittypedougnut"></div>
					</td>									
				</tr>
			</table>
			<!--
				<tr>
					<td align="left">
						<div id="visithistogram"></div>
					</td>
					<td align="right">
						<div id="dougnutchart"></div>
					</td>
				</tr>
				<tr>
					<td align="center">
						<div id="choronologicalvis"></div>
					</td>
				</tr>
			</table>
			-->
		</div>
		<!--
		
		<div class="col-sm-2">
			<div class="panel-group" id="accordionRight" role="tablist" aria-multiselectable="true">
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingRightOne">
				  <h4 class="panel-title">
					<a data-toggle="collapse" data-parent="#accordionRight" href="#collapseRightOne" aria-expanded="true" aria-controls="collapseRightOne">
					  Item #1
					</a>
				  </h4>
				</div>
				<div id="collapseRightOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingRightOne">
				  <div class="panel-body">
					
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingRightTwo">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordionRight" href="#collapseRightTwo" aria-expanded="false" aria-controls="collapseRightTwo">
					  Item #2
					</a>
				  </h4>
				</div>
				<div id="collapseRightTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingRightTwo">
				  <div class="panel-body">
					
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingRightThree">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordionRight" href="#collapseRightThree" aria-expanded="false" aria-controls="collapseRightThree">
					  Item #3
					</a>
				  </h4>
				</div>
				<div id="collapseRightThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingRightThree">
				  <div class="panel-body">
					
				  </div>
				</div>
			  </div>
			</div>
		</div>
		-->
</body>
<script type="text/javascript" src="js/filterFunction.js"></script>
<script type="text/javascript">
	function unique(list) {
	    var result = [];
	    $.each(list, function(i, e) {
	        if ($.inArray(e, result) == -1) result.push(e);
	    });
    	return result;
	}
	$( document ).ready(function() {
		for(var i=2005;i<2014;i++){
		  $("#daterangestart").append('<option value="'+i+'">'+i+'</option>');
		}
		$("#daterangeend").append('<option value="'+2014+'">'+2014+'</option>');
		for(var i=2013;i>=2005;i--){
		  $("#daterangeend").append('<option value="'+i+'">'+i+'</option>');
		}
		for(var i=1;i<100;i++){
		  $("#agerangestart").append('<option value="'+i+'">'+i+'</option>');
		}
		$("#agerangeend").append('<option value="'+100+'">'+100+'</option>');
		for(var i=99;i>=1;i--){
		  $("#agerangeend").append('<option value="'+i+'">'+i+'</option>');
		}
		//$('#checkboxes').append('<input type="checkbox" /> ' + text + '<br />');	optArray=unique(optArray.sort());	
		var tempJobsArr = [],tempImmunizationsArr = [], tempMarStatusArr = [];
		for(var i=0;i<allEncounters.length;i++){
			tempJobsArr.push(allEncounters[i]['job']);
			tempMarStatusArr.push(allEncounters[i]['marriage_status']);
			for(var j=0;j<allEncounters[i]['immunizations'].length;j++){
				tempImmunizationsArr.push(allEncounters[i]['immunizations'][j]);
			}
		}
		tempJobsArr = unique(tempJobsArr.sort());
		tempMarStatusArr = unique(tempMarStatusArr.sort());
		tempImmunizationsArr = unique(tempImmunizationsArr.sort())

		for(var i=0;i<tempJobsArr.length;i++){
			$('#joboptionlist').append('<input onchange="applyFilters();" checked="checked" type="checkbox" value="'+tempJobsArr[i]+'" /> ' + tempJobsArr[i] + '<br />');
		}

		for(var i=0;i<tempMarStatusArr.length;i++){
			$('#marriagestatusoptionlist').append('<input onchange="applyFilters();" checked="checked" type="checkbox" value="'+tempMarStatusArr[i]+'" /> ' + tempMarStatusArr[i] + '<br />');
		}

		for(var i=0;i<tempImmunizationsArr.length;i++){
			$('#immunizationoptionlist').append('<input onchange="applyFilters();" type="checkbox" value="'+tempImmunizationsArr[i]+'" /> ' + tempImmunizationsArr[i] + '<br />');
		}

		applyFilters();
    	//console.log("ready!");
	});
</script>
</html>